{% extends "base.html" %}
{% block title %}{{ '新增建筑' if not building else '编辑建筑：' + building.name }}{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-10 col-xl-8">
        <h2 class="mb-4 text-center">
            <i class="bi bi-building me-2"></i>
            {{ '新增小区/建筑' if not building else '编辑小区/建筑信息' }}
        </h2>

        <div class="card shadow-sm">
            <div class="card-body p-4">
                <form method="post">
                    <!-- 表单 action 为空，提交到当前页面 /edit_building/<bid> 或 /add_building -->

                    <div class="row g-4">
                        <div class="col-md-6">
                            <label class="form-label">小区/建筑名称 <span class="text-danger">*</span></label>
                            <input type="text" name="name" class="form-control" value="{{ building.name or '' }}" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">类型 <span class="text-danger">*</span></label>
                            <select name="type" class="form-select" required>
                                <option value="">-- 请选择 --</option>
                                <option value="小区" {% if building.type == '小区' %}selected{% endif %}>小区</option>
                                <option value="私人住宅" {% if building.type == '私人住宅' %}selected{% endif %}>私人住宅</option>
                                <option value="大型出租房" {% if building.type == '大型出租房' %}selected{% endif %}>大型出租房</option>
                                <option value="商业建筑" {% if building.type == '商业建筑' %}selected{% endif %}>商业建筑</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">所属网格 <span class="text-danger">*</span></label>
                            <select name="grid_id" class="form-select" required>
                                <option value="">-- 请选择网格 --</option>
                                {% for g in grids %}
                                <option value="{{ g.id }}" {% if building.grid_id == g.id %}selected{% endif %}>{{ g.name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">地址</label>
                            <input type="text" name="address" class="form-control" value="{{ building.address or '' }}">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">建筑年份</label>
                            <input type="text" name="build_year" class="form-control" value="{{ building.build_year or '' }}" placeholder="如2015">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">户型数</label>
                            <input type="text" name="households" class="form-control" value="{{ building.households or '' }}">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">楼梯/座数</label>
                            <input type="text" name="floors" class="form-control" value="{{ building.floors or '' }}">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">约居住人数</label>
                            <input type="text" name="residents" class="form-control" value="{{ building.residents or '' }}">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">企业数（含居家办公）</label>
                            <input type="text" name="enterprises" class="form-control" value="{{ building.enterprises or '' }}">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">底商店铺数</label>
                            <input type="text" name="shops" class="form-control" value="{{ building.shops or '' }}">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">是否安装燃气管道</label>
                            <select name="gas" class="form-select">
                                <option value="是" {% if building.gas == '是' %}selected{% endif %}>是</option>
                                <option value="否" {% if building.gas == '否' or not building.gas %}selected{% endif %}>否</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">物业费标准</label>
                            <input type="text" name="property_fee" class="form-control" value="{{ building.property_fee or '' }}" placeholder="如2.5元/㎡/月">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">电梯数</label>
                            <input type="text" name="elevators" class="form-control" value="{{ building.elevators or '' }}">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">室内车位数</label>
                            <input type="text" name="indoor_parking" class="form-control" value="{{ building.indoor_parking or '' }}">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">室外车位数</label>
                            <input type="text" name="outdoor_parking" class="form-control" value="{{ building.outdoor_parking or '' }}">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">安全管理负责人</label>
                            <input type="text" name="manager" class="form-control" value="{{ building.manager or '' }}">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">安全管理负责人电话</label>
                            <input type="text" name="manager_phone" class="form-control" value="{{ building.manager_phone or '' }}">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">开发商</label>
                            <input type="text" name="developer" class="form-control" value="{{ building.developer or '' }}">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">建筑商</label>
                            <input type="text" name="constructor" class="form-control" value="{{ building.constructor or '' }}">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">物业管理企业</label>
                            <input type="text" name="property_company" class="form-control" value="{{ building.property_company or '' }}">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">物业联系人电话</label>
                            <input type="text" name="property_phone" class="form-control" value="{{ building.property_phone or '' }}">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">纬度</label>
                            <input type="text" name="latitude" class="form-control" value="{{ building.latitude or '' }}">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">经度</label>
                            <input type="text" name="longitude" class="form-control" value="{{ building.longitude or '' }}">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">业委会联系人（小区专用）</label>
                            <input type="text" name="committee_contact" class="form-control" value="{{ building.committee_contact or '' }}">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">业委会联系人电话（小区专用）</label>
                            <input type="text" name="committee_phone" class="form-control" value="{{ building.committee_phone or '' }}">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">业主姓名（私人住宅专用）</label>
                            <input type="text" name="owner_name" class="form-control" value="{{ building.owner_name or '' }}">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">业主电话（私人住宅专用）</label>
                            <input type="text" name="owner_phone" class="form-control" value="{{ building.owner_phone or '' }}">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">房东姓名（大型出租房专用）</label>
                            <input type="text" name="landlord_name" class="form-control" value="{{ building.landlord_name or '' }}">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">房东电话（大型出租房专用）</label>
                            <input type="text" name="landlord_phone" class="form-control" value="{{ building.landlord_phone or '' }}">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">商业类型（商业建筑专用）</label>
                            <select name="business_type" class="form-select">
                                <option value="">-- 请选择 --</option>
                                <option value="商场" {% if building.business_type == '商场' %}selected{% endif %}>商场</option>
                                <option value="办公楼" {% if building.business_type == '办公楼' %}selected{% endif %}>办公楼</option>
                                <option value="写字楼" {% if building.business_type == '写字楼' %}selected{% endif %}>写字楼</option>
                                <option value="酒店" {% if building.business_type == '酒店' %}selected{% endif %}>酒店</option>
                                <option value="餐饮街" {% if building.business_type == '餐饮街' %}selected{% endif %}>餐饮街</option>
                                <option value="市场" {% if building.business_type == '市场' %}selected{% endif %}>市场</option>
                                <option value="混合" {% if building.business_type == '混合' %}selected{% endif %}>混合</option>
                            </select>
                        </div>
                        <div class="col-12">
                            <label class="form-label">备注</label>
                            <textarea name="notes" class="form-control" rows="4">{{ building.notes or '' }}</textarea>
                        </div>
                    </div>

                    <div class="text-center mt-5">
                        <button type="submit" class="btn btn-primary btn-lg px-5">
                            <i class="bi bi-check-circle me-2"></i>{{ '保存建筑信息' }}
                        </button>
                        <a href="{{ url_for('management.buildings') }}" class="btn btn-secondary btn-lg px-5 ms-3">
                            <i class="bi bi-arrow-left me-2"></i>返回列表
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}
