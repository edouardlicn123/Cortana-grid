<!-- templates/buildings.html -->
{% extends "base.html" %}
{% block title %}建筑管理{% endblock %}

<!-- 插入通用列表界面css -->
{% include 'includes/_list_management.html' %}

{% block content %}
<!-- 新增一个 wrapper 来应用 padding -->
<div class="content-wrapper">
    <div class="row justify-content-center">
        <div class="col-lg-12">
            <div class="card shadow mb-4">
                <div class="card-header py-3 d-flex justify-content-between align-items-center">
                    <h5 class="m-0 font-weight-bold text-primary">
                        <i class="bi bi-buildings me-2"></i>建筑/小区管理
                    </h5>
                    <a href="{{ url_for('building.add') }}" class="btn btn-success btn-sm">
                        <i class="bi bi-plus-lg me-1"></i>新增建筑
                    </a>
                </div>
                <div class="card-body">

                    <div class="table-responsive">
                        <table class="table table-hover table-bordered align-middle">
                            <thead class="table-light">
                                <tr>
                                    <th width="5%">#</th>
                                    <th width="30%">小区/建筑名称</th>
                                    <th width="15%">类型</th>
                                    <th width="15%">所属网格</th>
                                    <th width="10%">居住人数</th>
                                    <th width="25%" class="text-center">操作</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% if buildings %}
                                    {% for b in buildings %}
                                    <tr>
                                        <td>{{ loop.index }}</td>
                                        <td><strong>{{ b.name }}</strong></td>
                                        <td>{{ b.type_display }}</td> {# 确保显示中文名称 #}
                                        <td>{{ b.grid_name }}</td>
                                        <td>
                                            <span class="badge bg-info fs-6">
                                                {{ b.person_count }}
                                            </span>
                                        </td>
                                        <td class="text-center">
                                            <a href="{{ url_for('building.view', bid=b.id) }}" 
                                               class="btn btn-info btn-sm me-1" title="查看详情">
                                                <i class="bi bi-eye"></i>
                                            </a>
                                            <a href="{{ url_for('building.edit', bid=b.id) }}" 
                                               class="btn btn-warning btn-sm me-1" title="编辑">
                                                <i class="bi bi-pencil"></i>
                                            </a>
                                            <form action="{{ url_for('building.delete', bid=b.id) }}" method="POST" class="d-inline">
                                                <button type="submit" 
                                                        class="btn btn-danger btn-sm" 
                                                        title="删除"
                                                        onclick="return confirm('确定要删除「{{ b.name }}」吗？此操作将软删除该建筑，且不可恢复！')">
                                                    <i class="bi bi-trash"></i>
                                                </button>
                                            </form>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                {% else %}
                                    <tr>
                                        <td colspan="6" class="text-center text-muted py-4">
                                            <i class="bi bi-inbox fs-1 d-block mb-3"></i>
                                            暂无建筑记录，请点击右上角“新增建筑”添加
                                        </td>
                                    </tr>
                                {% endif %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
