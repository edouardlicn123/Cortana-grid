<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <!-- 动态标题部分 -->
    {% include 'includes/_title.html' %}
    
    <!-- 全局CSS -->
    {% include 'includes/_styles.html' %}
    
    <!-- 子模板可以在这里插入页面专用样式 -->
    {% block page_styles %}{% endblock %}
    
    <!-- 水印功能开始，必须先于脚本 -->
    {% if current_user.is_authenticated %}
    <script>
        window.watermarkUsername = "{{ current_user.display_name | e }}";
    </script>
    {% endif %}
    <!-- 水印功能结束 -->
    
    <!-- 全局脚本（Bootstrap 等基础 JS） -->
    {% include 'includes/_scripts.html' %}

</head>

<body>
    <!-- 导航栏 -->
    {% include 'includes/_navbar.html' %}

    <!-- 主内容区域 -->
    <main class="container-fluid py-4">
        <!-- 全局顶部间距容器：避开固定导航栏 + 容纳 Flash 消息 -->
        <div style="padding-top: 60px; min-height: calc(100vh - 200px);">
            <div class="container-fluid">

                <!-- Flash 消息 -->
                {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                        <div class="row justify-content-center mb-4" id="flash-messages-container">
                            <div class="col-lg-10 col-xl-8">
                                {% for category, message in messages %}
                                <div class="alert alert-{{ 'danger' if category == 'error' else category }} alert-dismissible fade show" 
                                     role="alert" 
                                     id="flash-{{ loop.index }}">
                                    <i class="bi bi-exclamation-triangle-fill me-2"></i>{{ message | safe }}
                                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="关闭"></button>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                    {% endif %}
                {% endwith %}

                <!-- 子模板主内容（只出现一次！） -->
                {% block content %}{% endblock %}

            </div>
        </div>
    </main>

    <!-- 页脚 -->
    {% include 'includes/_footer.html' %}

    <!-- 子模板额外 JS 占位（关键修复！） -->
    <!-- 所有子模板（如 overview.html）的 extra_js 都会插入这里 -->
    <!-- 必须放在 </body> 之前，保证 DOM 加载完成 -->
    {% block extra_js %}
        <!-- 默认空，子模板可覆盖 -->
    {% endblock %}

</body>
</html>
